FROM node:20-alpine

ENV NODE_ENV=development

WORKDIR /app

RUN apk add --no-cache curl

COPY shared /app/shared
WORKDIR /app/shared
RUN npm install && npm run build

WORKDIR /app
COPY services/tasks/package.json services/tasks/package-lock.json ./
RUN npm install

COPY services/tasks/ .

EXPOSE 3001
EXPOSE 51204

CMD ["npm", "run", "start:dev"]